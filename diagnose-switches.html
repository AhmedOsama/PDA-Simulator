<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ´Ø®ÙŠØµ Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ù€ Switches</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="preload" href="assets/FinalCover.png" as="image">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <style>
        body {
            padding: 20px;
            background: #f5f5f5;
        }
        .diagnostic-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .issue {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .issue.error {
            background: #ffebee;
            border-left: 4px solid #f44336;
        }
        .issue.warning {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
        }
        .issue.success {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
        }
        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mb-4">ğŸ” ØªØ´Ø®ÙŠØµ Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ù€ Switches</h1>
        
        <div class="diagnostic-card">
            <h3>1. ÙØ­Øµ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…ÙƒØ±Ø±Ø©</h3>
            <div id="duplicateCheck"></div>
        </div>
        
        <div class="diagnostic-card">
            <h3>2. ÙØ­Øµ Ø§Ù„Ù€ Event Listeners</h3>
            <div id="listenerCheck"></div>
        </div>
        
        <div class="diagnostic-card">
            <h3>3. ÙØ­Øµ Ø­Ø§Ù„Ø© localStorage</h3>
            <div id="storageCheck"></div>
        </div>
        
        <div class="diagnostic-card">
            <h3>4. ÙØ­Øµ Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ù…Ø·Ø¨Ù‚Ø©</h3>
            <div id="styleCheck"></div>
        </div>
        
        <div class="diagnostic-card">
            <h3>5. Ø§Ø®ØªØ¨Ø§Ø± Ø³Ø±ÙŠØ¹</h3>
            <button class="btn btn-primary" onclick="runFullDiagnostic()">ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ´Ø®ÙŠØµ Ø§Ù„ÙƒØ§Ù…Ù„</button>
            <button class="btn btn-warning ms-2" onclick="fixAllIssues()">Ø¥ØµÙ„Ø§Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„</button>
            <div id="testResults" class="mt-3"></div>
        </div>
    </div>
    
    <script>
        function checkDuplicates() {
            const ids = ['autoModeSwitch', 'exerciseautoModeSwitch', 'statusautoModeSwitch', 'planautoModeSwitch'];
            let html = '';
            
            ids.forEach(id => {
                const elements = document.querySelectorAll(`#${id}`);
                if (elements.length === 0) {
                    html += `<div class="issue error">âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰: ${id}</div>`;
                } else if (elements.length > 1) {
                    html += `<div class="issue error">âš ï¸ Ø¹Ù†Ø§ØµØ± Ù…ÙƒØ±Ø±Ø©: ${id} (${elements.length} Ù†Ø³Ø®Ø©)</div>`;
                } else {
                    html += `<div class="issue success">âœ… ${id} Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø©</div>`;
                }
            });
            
            document.getElementById('duplicateCheck').innerHTML = html;
        }
        
        function checkListeners() {
            const ids = ['autoModeSwitch', 'exerciseautoModeSwitch', 'statusautoModeSwitch', 'planautoModeSwitch'];
            let html = '';
            
            ids.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    // Check if element has event listeners (this is a simplified check)
                    const hasOnclick = element.onclick !== null;
                    const hasOnchange = element.onchange !== null;
                    
                    if (hasOnclick || hasOnchange) {
                        html += `<div class="issue warning">âš ï¸ ${id} Ù„Ø¯ÙŠÙ‡ inline handlers</div>`;
                    } else {
                        html += `<div class="issue success">âœ… ${id} Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ inline handlers</div>`;
                    }
                }
            });
            
            document.getElementById('listenerCheck').innerHTML = html;
        }
        
        function checkStorage() {
            const keys = ['autoModeSwitch', 'exerciseautoModeSwitch', 'statusautoModeSwitch', 'planautoModeSwitch'];
            let html = '<table class="table table-sm">';
            html += '<thead><tr><th>Ø§Ù„Ù…ÙØªØ§Ø­</th><th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th></tr></thead><tbody>';
            
            keys.forEach(key => {
                const value = localStorage.getItem(key);
                const element = document.getElementById(key);
                const domState = element ? element.checked : null;
                
                html += '<tr>';
                html += `<td>${key}</td>`;
                html += `<td>${value || 'ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯'}</td>`;
                html += `<td>DOM: ${domState !== null ? (domState ? 'ON' : 'OFF') : 'N/A'}</td>`;
                html += '</tr>';
            });
            
            html += '</tbody></table>';
            document.getElementById('storageCheck').innerHTML = html;
        }
        
        function checkStyles() {
            const ids = ['autoModeSwitch'];
            let html = '';
            
            ids.forEach(id => {
                const elements = document.querySelectorAll(`#${id}`);
                elements.forEach((element, index) => {
                    if (element) {
                        const track = element.parentElement?.querySelector('.switch-track');
                        const thumb = element.parentElement?.querySelector('.switch-thumb');
                        
                        html += `<div class="issue">`;
                        html += `<strong>${id} ${elements.length > 1 ? `(Ù†Ø³Ø®Ø© ${index + 1})` : ''}</strong><br>`;
                        html += `Checked: ${element.checked}<br>`;
                        
                        if (track) {
                            const trackBg = window.getComputedStyle(track).background;
                            html += `Track background: ${trackBg.substring(0, 50)}...<br>`;
                        }
                        
                        if (thumb) {
                            const thumbTransform = window.getComputedStyle(thumb).transform;
                            const thumbBg = window.getComputedStyle(thumb).background;
                            html += `Thumb transform: ${thumbTransform}<br>`;
                            html += `Thumb background: ${thumbBg.substring(0, 50)}...<br>`;
                        }
                        
                        html += `</div>`;
                    }
                });
            });
            
            document.getElementById('styleCheck').innerHTML = html;
        }
        
        function runFullDiagnostic() {
            checkDuplicates();
            checkListeners();
            checkStorage();
            checkStyles();
            
            document.getElementById('testResults').innerHTML = 
                '<div class="alert alert-info">âœ… Ø§Ù„ØªØ´Ø®ÙŠØµ Ø§Ù„ÙƒØ§Ù…Ù„ ØªÙ… Ø¨Ù†Ø¬Ø§Ø­</div>';
        }
        
        function fixAllIssues() {
            // Remove duplicates
            const ids = ['autoModeSwitch', 'exerciseautoModeSwitch', 'statusautoModeSwitch', 'planautoModeSwitch'];
            
            ids.forEach(id => {
                const elements = document.querySelectorAll(`#${id}`);
                if (elements.length > 1) {
                    // Keep only the first one
                    for (let i = 1; i < elements.length; i++) {
                        elements[i].remove();
                    }
                }
            });
            
            // Clear inline handlers
            ids.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.onclick = null;
                    element.onchange = null;
                }
            });
            
            document.getElementById('testResults').innerHTML = 
                '<div class="alert alert-success">âœ… ØªÙ… Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ - Ù‚Ù… Ø¨Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ´Ø®ÙŠØµ</div>';
            
            setTimeout(runFullDiagnostic, 500);
        }
        
        // Auto-run diagnostic on load
        window.addEventListener('DOMContentLoaded', function() {
            setTimeout(runFullDiagnostic, 500);
        });
    </script>
</body>
</html>
